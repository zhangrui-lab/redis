* 降低Redis的内存占用有助于减少创建快照和加载快照所需的时间、提升载入AOF文件和重写AOF文件时的效率、缩短从服务器进行同步所需的时间，并且能让Redis存储更多的数据而无需添加额外的硬件。

#### 短结构

* Redis为列表、集合、散列和有序集合提供了一组配置选项，这些选项可以让Redis以更节约空间的方式存储长度较短的结构(后面简称“短结构”)。
* 在列表、散列和有序集合的长度较短或者体积较小的时候，Redis可以选择使用一种名 为压缩列表(ziplist)的紧凑存储方式来存储这些结构。压缩列表是列表、散列和有序集合 这3种不同类型的对象的一种非结构化(unstructured)表示:与Redis在通常情况下使用 双链表表示列表、使用散列表表示散列、使用散列表加上跳跃表(skiplist)表示有序集合 的做法不同，压缩列表会以序列化的方式存储数据，这些序列化数据每次被读取的时候都 要进行解码，每次被写入的时候也要进行局部的重新编码，并且可能需要对内存里面的数 据进行移动。

##### 压缩列表表示

* 为了了解压缩列表比其他数据结构更为节约内存的原因，我们需要对使用压缩列表的几种结 构当中，最为简单的列表结构进行观察。在典型的双向链表(doubly linked list)里面，链表包含 的每个值都会由一个节点(node)表示，每个节点都会带有指向链表中前一个节点和后一个节点 的指针，以及一个指向节点包含的字符串值的指针。每个节点包含的字符串值都会分为3个部分 进行存储:第一部分存储的是字符串的长度，第二部分存储的是字符串值中剩余可用的字节数 量，而最后一部分存储的则是以空字符结尾的字符串本身。
* 另一方面，压缩列表是由节点组成的序列(sequence), 每个节点都由两个长度值和一个字符串组成。第一个长度值记录的是前一个节点的长度，这个长度值将被用于对压缩列表进行从后向 前的遍历，第二个长度值记录了当前节点的长度，而位于节点最后的则是被存储的字符串值。

##### 使用压缩列表编码

* 为了确保压缩列表只会在有需要降低内存占用的情况下使用，Redis引入了配置选项，这些选项决定了列表、散列和有序集合会在什么情况下使用压缩列表表示

  ```
  list-max-ziplist-entries 512  
  list-max-ziplist-value 64   列表结构使用压缩列, 表表示的限制条件。
  hash-max-ziplist-entries 512
  hash-max-ziplist-value 64		散列结构使用压缩列表, 表示的限制条件
  zset-max-ziplist-entries 128
  zset-max-ziplist-value 64		有序集合使用压缩列, 表表示的限制条件。
  ```

* 列表、散列和有序集合的基本配置选项都很相似，它们都由-max-ziplist-entries选项和-max-ziplist-value选项组成，并且这3组选项的语义也基本相同:entries选项说 明列表、散列和有序集合在被编码为压缩列表的情况下，允许包含的最大元素数量；而value 选项则说明了压缩列表每个节点的最大体积是多少个字节。当这些选项设置的限制条件中的任意 一个被突破的时候，Redis就会将相应的列表、散列或是有序集合从压缩列表编码转换为其他结 构，而内存占用也会因此而增加。

